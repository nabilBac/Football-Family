<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>GoalClips - Feed</title>
    
    <link href="/css/tailwind.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    
    <style>
        /* Styles de base pour le design sombre mobile */
        body { 
            background: black; 
            color: white; 
            min-height: 100vh;
            /* Espace pour la navbar inférieure (60px) */
            padding-bottom: 60px; 
            overflow-x: hidden;
            font-family: sans-serif;
        }

        /* Masquer la scrollbar pour un look d'application mobile */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Style de la barre de navigation inférieure (basé sur votre fragment) */
        .mobile-navbar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 60px;
            background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(5px);
            display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid #1a1a1a; z-index: 1000;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center;
            color: #777; font-size: 1.3rem; transition: color 0.2s;
        }
        /* Style actif pour la couleur verte comme sur l'image */
        .nav-item.active { color: #10B981; } 
        .nav-item:hover { color: white; }
        
        /* Bouton flottant "POST YOUR GOAL" */
        .post-goal-container {
            position: fixed; 
            bottom: 30px; /* Décalé de la moitié de la navbar */
            left: 50%; 
            transform: translate(-50%, 50%); /* Centrage */
            z-index: 1001; 
        }
        .post-goal-btn-style {
            width: 60px; height: 60px;
            background: #10B981; /* Vert émeraude */
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.5);
            color: white; font-size: 1.5rem; border: 4px solid black; 
        }

        /* Style pour la card vidéo */
        .video-card-feed {
    position: relative; 
    width: 100%; 
    /* CHANGÉ : Hauteur réduite (par exemple, 250px) pour ressembler à une carte de feed */
    height: 250px; 
    margin-bottom: 20px; 
    overflow: hidden; 
    border-radius: 12px;
    background: #222; /* Ajout d'un fond pour les bords */
}
        .video-card-feed video {
    width: 100%; 
    height: 100%; 
    /* CHANGÉ : Utilisez 'contain' au lieu de 'cover' si la vidéo est plus large que la carte, 
       sinon utilisez 'cover' pour garder l'effet immersif. 
       Nous gardons 'cover' mais la hauteur est réduite. */
    object-fit: cover; 
    display: block;
}
       .video-overlay {
    position: absolute; bottom: 0; left: 0; width: 100%;
    background: linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0));
    padding: 40px 15px 10px; color: white;
}
    </style>
</head>

<body> 
    <header class="fixed top-0 left-0 w-full z-20 p-3 flex justify-between items-center bg-black border-b border-gray-800"
            style="height: 60px;">
        <div class="flex items-center space-x-2">
            <i class="fas fa-futbol text-emerald-500 text-2xl"></i>
            <span class="text-white text-xl font-bold tracking-tight">GOALCLIPS</span>
        </div>
        
        <div class="flex space-x-2 no-scrollbar overflow-x-scroll flex-1 mx-4">
            <div th:each="i : ${#numbers.sequence(1, 5)}" class="w-8 h-8 rounded-full border border-gray-600 bg-gray-700 flex-shrink-0"></div>
        </div>
        
        <div class="flex items-center space-x-3 flex-shrink-0">
            <a href="/profile"><i class="fa-solid fa-user text-xl text-gray-300"></i></a>
            <button class="text-xl text-gray-300 hover:text-white"><i class="fa-solid fa-bars"></i></button>
        </div>
    </header>
    
    <main class="relative w-full overflow-hidden" style="padding-top: 60px;">

        <section class="p-3 bg-black sticky top-[60px] z-10 border-b border-gray-800">
             <div class="flex justify-between items-center mb-2">
                 <h2 class="text-lg font-semibold">Event Stories</h2>
                 <a href="/search" class="text-gray-400 hover:text-white"><i class="fa-solid fa-search"></i></a>
             </div>
             <div class="flex space-x-4 overflow-x-scroll no-scrollbar pb-2">
                 <div th:each="i : ${#numbers.sequence(1, 8)}" class="flex-shrink-0 w-14 h-14 rounded-full border-2 border-emerald-500 overflow-hidden bg-gray-700">
                 </div>
             </div>
        </section>

        <section id="video-feed" class="w-full relative py-4 px-3">
            
            <div th:each="videoDto : ${videos}" class="video-card-feed">
                
                <video muted playsinline controls preload="metadata" class="w-full h-full">
                    <source th:src="@{/videos/{filename}(filename=${videoDto.filename})}" type="video/mp4">
                    Votre navigateur ne supporte pas la balise vidéo.
                </video>

                <div class="video-overlay">
                    
                    <p class="text-sm font-light text-gray-300 mb-1">29/09 Match FC Asile | Stade Municipal</p>

                    <div class="flex justify-between items-end mb-2">
                        <h3 th:text="${videoDto.title}" class="text-md font-bold">
                            Titre de la vidéo
                        </h3>
                        <div class="flex flex-col items-center text-sm text-gray-200">
                            <span th:text="${videoDto.likesCount}">365</span>
                            <i th:classappend="${videoDto.likedByCurrentUser} ? 'text-emerald-500' : 'text-white'" 
                               class="fa-solid fa-heart text-xl cursor-pointer"></i>
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center text-xs text-gray-400">
                        <div class="flex items-center space-x-2">
                            <img src="/images/avatar-placeholder.jpg" alt="Avatar" class="w-6 h-6 rounded-full object-cover border border-emerald-500">
                            <span th:text="${videoDto.uploaderUsername}" class="font-semibold text-white">@UploaderUsername</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span>243</span>
                            <i class="fa-solid fa-comment-dots"></i>
                        </div>
                    </div>

                </div>
            </div>
            
            <div id="loader" class="text-center p-4 text-gray-400">
                <i class="fa-solid fa-spinner fa-spin mr-2"></i> Loading clips...
            </div>
        </section>
        
        <section class="p-3 bg-black border-t border-gray-800 mt-4">
             <div class="flex justify-between items-center">
                 <h2 class="text-lg font-semibold text-emerald-500">Upcoming Events</h2>
                 <h2 class="text-lg font-semibold">Club Stories</h2>
             </div>
             <div class="flex justify-between items-center mt-2">
                 <div class="flex items-center text-sm text-gray-400">
                    <i class="fa-solid fa-calendar-alt mr-2 text-emerald-500"></i>
                    <span>19:00 Match: FC Agile vs. Red Stars</span>
                 </div>
                 <div class="flex space-x-[-8px]">
                    <div th:each="i : ${#numbers.sequence(1, 3)}" class="w-8 h-8 rounded-full border-2 border-black bg-gray-700 flex-shrink-0"></div>
                 </div>
             </div>
        </section>
    </main>

    <a href="/upload" class="post-goal-container">
        <div class="post-goal-btn-style">
             <i class="fa-solid fa-bullseye text-lg"></i> 
        </div>
    </a>
    
    <div class="fixed bottom-0 left-0 w-full z-1000">
        <nav th:replace="~{fragments/navbar :: mobile-navbar}"></nav>
    </div>
    
    <script th:replace="~{fragments/navbar :: navbar-script}"></script>
    
    <script>
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
              .then(registration => {
                console.log('SW enregistré avec succès. Portée: ', registration.scope);
              })
              .catch(registrationError => {
                console.log('Échec de l\'enregistrement du SW: ', registrationError);
              });
          });
        }
    </script>
    
</body>
</html>